| Id | Steps                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | Details                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| -- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1  | Make sure you have the latest deployment of the microservice that you want to work on. In our example case, we have created a deployment called mahesh-my-microservice as explained previously.                                                                                                                                                                                                                                                                                       | <pre>$ kubectl get deployment<br>NAME                     READY   UP-TO-DATE   AVAILABLE   AGE<br>mahesh-my-microservice   1/1     1            1           5m39s<br></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 2  | Connect telepresence to your K8s cluster, telepresence will use the config file in the ./kube folder to identify the cluster to which it will connect.                                                                                                                                                                                                                                                                                                                                | <pre>#This will connect telepresence daemon on your workstation with telepresence traffic manager on the K8s cluster<br>$ telepresence connect<br>Connected to context minikube (https://192.168.49.2:8443)<br> <br>#This will list all the workloads we can intercept<br>$ telepresence list<br>mahesh-my-microservicemy-microservice: ready to intercept (traffic-agent not yet installed)<br> <br>#Currently we are in application directory<br>$ pwd<br>/home/..../Telepresence-examples-main/example2/<br> <br>#We will create a folder to store all the different volume mounts from the k8s deployment<br>$ mkdir local_volume_mount<br> <br>#Run below command to intercept the miroservice<br>#--port is the port on your workstation where all the traffic from  the K8s cluster will be #routed to.<br>#--env-file will create a .env file in the specified path and name with all the envoirment #variables in #at the container level.<br>#--mount will copy all the volume mounts of worklaod to the path specified.<br> <br>$ telepresence intercept mahesh-my-microservice --port 5000 --env-file ./local.env --mount ./local_volume_mount/<br>Using Deployment mahesh-my-microservice<br>intercepted<br>   Intercept name         : mahesh-my-microservice<br>   State                  : ACTIVE<br>   Workload kind          : Deployment<br>   Destination            : 127.0.0.1:5000<br>   Service Port Identifier: http<br>   Volume Mount Point     : /home/..../Telepresence-examples-main/example2/local_volume_mount<br>   Intercepting           : all TCP requests <br> <br>#NOTE:Windows can only perform remote mounts using drives,and not folders hence we need to provide a Letter for #drive(unused) followed by a colon i.e --mount=X:, Therefore for windows user the command will look like this<br>PS C:\\Users\\maheshp\\Desktop\\example2> telepresence intercept mahesh-my-microservice --port 5000 --env-file=.\\local.env --mount X:<br>Using Deployment mahesh-my-microservice<br>intercepted<br>   Intercept name         : mahesh-my-microservice<br>   State                  : ACTIVE<br>   Workload kind          : Deployment<br>   Destination            : 127.0.0.1:5001<br>   Service Port Identifier: http<br>   Volume Mount Point     : X:<br>   Intercepting           : all TCP requests<br></pre> |
| 3  | We can see that all the directories in volume mount(/app/static in the container) have been replicated to the local_volume_mount directory and all the environment variables(at container level) have been copied to local.env<br>                                                                                                                                                                                                                                                    |![image2](images/workflow2/image2.png)
| 4  | Now we can incorporate the static file in local_volume_mount and the env variables from local .env in the code running on our workstation to mimic the k8s cluster.<br>Here in our code running locally (iatcp-telepresence-maheshp-telepresence-examples-v1/example2/main.go ) we can see that we load and use the env variables from local.env(which has env values from the K8s cluster). Also, we serve the HTML page in the local_volume_mount (which is the replicated volume). | <pre>#We can see in line 21 and 26 of the code that we are loading and using the environment variables in the K8s cluster,that is from #local.env<br> <br>#line 21<br>$ sed -n 21p main.go<br>        err := godotenv.Load("local.env")<br>#line 26<br>$ sed -n 26p main.go<br>        envValue := os.Getenv("KUBERNETES_SERVICE_HOST") + ":" + os.Getenv("KUBERNETES_SERVICE_PORT") err :=<br> <br>#Serving the static file downaloaded at local_volume_mount which we replicated from the K8s cluster<br>#The below line is for linux/mac machines<br>tmpl, err := template.ParseFiles("./local_volume_mount/app/static/home.html")<br></pre><br>Note for Windows: Since the Directory specified for storing the replicated volume mount is different for Windows, please make the following edit:<br>Uncomment the below line and comment out the one for Linux in your example2/main.go file<br><pre>tmpl, err :=template.ParseFiles("X:/app/static/home.html")</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 5  | Run the go application on your workstation (example2/main.go)                                                                                                                                                                                                                                                                                                                                                                                                                         | <pre><br>#Current directory<br>$ pwd<br>/home/maheshp/Desktop/iatcp-telepresence-maheshp-telepresence-examples-v1/example2<br> <br>$ ls<br>example2-image/  go.mod  go.sum  helm/  main.go<br> <br># Run the golang http server<br>  go run main.go<br></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 6  | We can see from the image that the code running on our workstation is using the home.html, a file mounted in the K8s Container, and environment variables defined at the  K8s cluster, to serve the request mimicking the results at the K8s cluster's end.                                                                                                                                                                                                                           |![image2](images/workflow2/image2.png)
| 7  | Similarly, users can obtain and use the same environment variable values and files in the volume mounts in their workstation as it is present in the K8s cluster.                                                                                                                                                                                                                                                                                                                     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 8  | Once you are done intercepting you can stop the intercept and disconnect the telepresence.                                                                                                                                                                                                                                                                                                                                                                                            | <pre>#Run the below command to stop the intercept<br>$ telepresence leave mahesh-my-microservice<br> <br>#Run the below command to disconnect  telepresence<br>$ telepresence quit<br>Telepresence Daemons disconnecting...done<br></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
